(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"da371e64-ab18-468b-b035-428e27660adb","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),oe=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(u),O=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(u),re=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(u),ne=({avatar:e})=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(u),ce=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(u),se=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(u),ae=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(u),le=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),H=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:r,userId:c})=>{const s=le(),p=s.querySelector(".card__like-button"),y=s.querySelector(".card__like-count"),$=s.querySelector(".card__control-button_type_delete"),Y=s.querySelector(".card__control-button_type_info"),b=s.querySelector(".card__image"),ee=s.querySelector(".card__title");return b.src=e.link,b.alt=e.name,ee.textContent=e.name,y.textContent=e.likes.length,e.likes.some(te=>te._id===c)&&p.classList.add("card__like-button_is-active"),e.owner._id!==c?$.remove():n&&$.addEventListener("click",()=>n(e._id,s)),o&&p.addEventListener("click",()=>o(e._id,p,y)),t&&b.addEventListener("click",()=>t({name:e.name,link:e.link})),r&&Y.addEventListener("click",()=>r(e._id)),s},ie=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");t&&l(t)}};document.addEventListener("keydown",ie);const _=e=>{e.classList.add("popup_is-opened"),document.body.classList.add("body_no-scroll")},l=e=>{e.classList.remove("popup_is-opened"),document.body.classList.remove("body_no-scroll")},ue=e=>{const t=e.querySelector(".popup__close"),o=()=>l(e),n=r=>{r.target===e&&l(e)};t.addEventListener("click",o),e.addEventListener("click",n),e._closeHandlers={closeByButton:o,closeByOverlay:n}},h=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},W=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)},pe=(e,t,o)=>{if(t.hasAttribute("data-error-message")){const n=t.value,r=n.trim()==="",c=/^[a-zA-Zа-яА-ЯёЁ \-]+$/;if(r){h(e,t,"Обязательное поле",o);return}const s=2,p=t.classList.contains("popup__input_type_name")?40:30;if(n.length<s||n.length>p){const y=`Должно быть от ${s} до ${p} символов`;h(e,t,y,o);return}if(!c.test(n)){h(e,t,t.dataset.errorMessage,o);return}}if(!t.validity.valid){h(e,t,t.validationMessage,o);return}W(e,t,o)},de=(e,t)=>e.some(o=>o.classList.contains(t.inputErrorClass)),q=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},j=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},_e=(e,t,o)=>{de(e,o)?q(t,o):j(t,o)},fe=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);if(o.length===0){n&&j(n,t);return}q(n,t),o.forEach(r=>{r.addEventListener("input",()=>{pe(e,r,t),_e(o,n,t)})})},me=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.querySelector(e.inputSelector)&&(o.addEventListener("submit",r=>{r.preventDefault()}),fe(o,e))})},C=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.length!==0&&(o.forEach(r=>{W(e,r,t)}),q(n,t))},J=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),m=g.querySelector(".popup__form"),R=m.querySelector(".popup__input_type_name"),V=m.querySelector(".popup__input_type_description"),U=m.querySelector(".popup__button"),k=document.querySelector(".popup_type_new-card"),i=k.querySelector(".popup__form"),ye=i.querySelector(".popup__input_type_card-name"),he=i.querySelector(".popup__input_type_url"),A=i.querySelector(".popup__button"),E=document.querySelector(".popup_type_image"),M=E.querySelector(".popup__image"),ve=E.querySelector(".popup__caption"),I=document.querySelector(".popup_type_edit-avatar"),f=I.querySelector(".popup__form"),Se=f.querySelector(".popup__input_type_avatar"),D=f.querySelector(".popup__button"),B=document.querySelector(".popup_type_remove-card"),be=B.querySelector(".popup__form"),x=document.querySelector(".popup_type_info"),v=x.querySelector(".popup__info"),F=x.querySelector(".popup__list"),Le=document.querySelector(".profile__edit-button"),qe=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),T=document.querySelector(".profile__image");let L=null;const z=({name:e,link:t})=>{M.src=t,M.alt=e,ve.textContent=e,_(E)},d=(e,t)=>{const o=e.textContent;e.textContent=t?"Сохранение...":o,e.disabled=t},Ce=e=>{e.preventDefault(),d(U,!0),re({name:R.value,about:V.value}).then(t=>{w.textContent=t.name,P.textContent=t.about,l(g)}).catch(t=>{console.log(t)}).finally(()=>{d(U,!1)})},ge=e=>{e.preventDefault(),d(D,!0),ne(Se.value).then(t=>{T.style.backgroundImage=`url(${t.avatar})`,l(I)}).catch(t=>{console.error("Ошибка обновления аватара:",t)}).finally(()=>{d(D,!1)})},ke=e=>{e.preventDefault(),d(A,!0),ce({name:ye.value,link:he.value}).then(t=>{const o=H(t,{onPreviewPicture:z,onLikeIcon:K,onDeleteCard:Q,onInfoClick:X,userId:L});J.prepend(o),l(k),i.reset()}).catch(t=>{console.error("Ошибка добавления карточки:",t)}).finally(()=>{d(A,!1)})},K=(e,t,o)=>{const n=t.classList.contains("card__like-button_is-active");ae(e,n).then(r=>{o.textContent=r.likes.length,t.classList.toggle("card__like-button_is-active",!n)}).catch(r=>{console.error("Ошибка при изменении лайка:",r)})};let Z=null,G=null;const Q=(e,t)=>{Z=e,G=t,_(B)},Ee=e=>{e.preventDefault(),se(Z).then(()=>{G.remove(),l(B)}).catch(t=>{console.error("Ошибка удаления карточки:",t)})},Ie=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),N=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Be=e=>{const t=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0);return t.querySelector(".popup-info__user-avatar").src=e.avatar,t.querySelector(".popup-info__user-avatar").alt=e.name,t.querySelector(".popup-info__user-name").textContent=e.name,t},X=e=>{O().then(t=>{const o=t.find(r=>r._id===e);if(!o)throw new Error("Карточка не найдена");v.innerHTML="",F.innerHTML="",v.append(N("Дата создания:",Ie(o.createdAt))),v.append(N("Автор:",o.owner.name));const n=document.createElement("li");n.className="popup__info-item",n.innerHTML=`<dt class="popup__info-term">Лайки (${o.likes.length}):</dt>`,v.append(n),o.likes.forEach(r=>{F.append(Be(r))}),_(x)}).catch(t=>{console.error("Ошибка загрузки информации о карточке:",t)})},S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};me(S);m.addEventListener("submit",Ce);i.addEventListener("submit",ke);f.addEventListener("submit",ge);be.addEventListener("submit",Ee);Le.addEventListener("click",()=>{R.value=w.textContent,V.value=P.textContent,_(g),C(m,S)});T.addEventListener("click",()=>{f.reset(),_(I),C(f,S)});qe.addEventListener("click",()=>{i.reset(),_(k),C(i,S)});const xe=document.querySelectorAll(".popup");xe.forEach(e=>{ue(e)});Promise.all([O(),oe()]).then(([e,t])=>{L=t._id,w.textContent=t.name,P.textContent=t.about,T.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{const n=H(o,{onPreviewPicture:z,onLikeIcon:K,onDeleteCard:Q,onInfoClick:X,userId:L});J.append(n)})}).catch(e=>{console.log(e)});
